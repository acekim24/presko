<!-- LOGIN CARD -->
<div class="card" id="loginCard">
  <h2>Login with One-Time Code</h2>
  <p>Click below to generate a temporary login code. Check your webhook (Discord) for the code.</p>
  <button id="loginBtn">Generate Login Code</button>

  <!-- Instead of showing code, we ask for input -->
  <div style="margin-top:12px;">
    <input type="text" id="inputCode" placeholder="Enter code received" style="padding:8px;width:80%;border-radius:8px;border:none;margin-top:8px;">
    <button id="verifyBtn" style="margin-top:8px;">Verify Code</button>
  </div>

  <p id="status"></p>
</div>

<script>
const loginBtn = document.getElementById("loginBtn");
const verifyBtn = document.getElementById("verifyBtn");
const status = document.getElementById("status");
const loginCard = document.getElementById("loginCard");
const scanCard = document.getElementById("scanCard");
let generatedCode = "";

// Generate code and send to webhook
loginBtn.onclick = async () => {
  try {
    const res = await fetch("http://localhost:8765/send-code", {
      method: "POST",
    });
    if (res.ok) {
      status.textContent = "Login code sent to your webhook! Check Discord and enter it below.";
    } else {
      status.textContent = "Failed to generate code.";
    }
  } catch (err) {
    console.error(err);
    status.textContent = "Error sending code. Is the agent running?";
  }
};

// Verify code input by user
verifyBtn.onclick = async () => {
  const input = document.getElementById("inputCode").value.trim();
  if (!input) {
    status.textContent = "Please enter the code.";
    return;
  }

  try {
    const res = await fetch("http://localhost:8765/verify-code", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ code: input })
    });
    const data = await res.json();

    if (data.status === "ok") {
      status.textContent = "Code verified! Access granted.";
      loginCard.style.display = "none";
      scanCard.style.display = "block";
    } else {
      status.textContent = "Invalid code. Try again.";
    }
  } catch (err) {
    console.error(err);
    status.textContent = "Cannot verify code. Is the agent running?";
  }
};
</script>
